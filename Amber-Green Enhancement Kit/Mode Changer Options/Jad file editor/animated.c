/*
     ANIMATED.C

     Animated-Effects, assuming the tiles are 128.0 by 128.0
     An animated effect is generated at point 0.0, 0.0, 0.0

     Last change: 06.03.01 / PM
     		  06.06.01 / MP	
 */

#include "glhead.h"
#include "animated.h"
#include "display.h"
#include <math.h>

/******************************************************************************
* DEFINES								      *
******************************************************************************/

/* ----- WALLS ------ */
#define DISP_TILESIZE  128.0

/* ------ COLORS ---- */
#define TPCOLCOUNT   6
#define STARCOLCOUNT 5
#define TOTCOLCOUNT 11

#define ANIM_MAXCLOCKS 16

/******************************************************************************
* TYPEDEFS								      *
******************************************************************************/


/******************************************************************************
* DATA									      *
******************************************************************************/

GLfloat TPTexCoords[16] = {
    0.0,0.0,  0.5,0.0,   0.5,1.0,  0.0,1.0,
    0.5,0.0,  1.0,0.0,   1.0,0.0,  0.5,1.0
};		/* Two Textures on TexRect */

GLfloat SPStarTexCoords[24] = {
    0.0   ,0.0,  0.3333,0.0,   0.3333,1.0,  0.0,1.0,
    0.3333,0.0,  0.6666,0.0,   0.6666,1.0,  0.3333,1.0,
    0.6666,0.0,  1.0   ,0.0,   1.0   ,0.0,  0.6666,1.0
};	/* Three textures on TexRect */

/*************** TELEPORTSTARS ******************/

// TPStars-Pictures
// Size 16 by 16, 256 Colors ------------
// Colors RGBA
int TPColors[4][TPCOLCOUNT + STARCOLCOUNT ] = {
    { 0, 196, 216, 232, 248, 252,   172, 188, 200, 204,	252 },
    { 0,  44,  76, 116, 172, 160,   124, 188, 160, 204, 252 },
    { 0, 168, 172, 184, 208, 204,    48, 244,  52, 252, 252 },
    { 0, 255, 255, 255, 215, 175,   255, 255, 255, 215, 175 }
};


/* Picture 32 x 16, split in two for Display as Texture */
GLubyte TPStarPics[32 * 16] = {
    0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,   0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,   0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,   0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,1,2,1,0,0,0,0,0,0,   0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,1,2,1,0,0,0,0,0,0,   0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,
    0,0,0,0,0,0,1,2,3,2,1,0,0,0,0,0,   0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,
    0,0,0,0,1,1,2,3,4,3,2,1,1,0,0,0,   0,0,0,0,0,0,0,2,3,2,0,0,0,0,0,0,
    0,1,1,1,2,2,3,5,4,4,3,2,2,1,1,1,   0,0,0,0,0,1,2,3,4,3,2,1,0,0,0,0,
    0,0,0,0,1,1,2,3,4,3,2,1,1,0,0,0,   0,0,0,0,0,0,0,2,3,2,0,0,0,0,0,0,
    0,0,0,0,0,0,1,2,3,2,1,0,0,0,0,0,   0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,1,2,1,0,0,0,0,0,0,   0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,1,2,1,0,0,0,0,0,0,   0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,   0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,   0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,   0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,   0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
};

GLubyte SpellStarPics[48 * 16] = {
     /* Color 90h: Number 3 = 8 */   /* 91h = 6, 3Ah = 7, 0Fh  = 10 */
    0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,   0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,     0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,   0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,     0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,   0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,     0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,   0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,     0,0,0,0,0,0,0,0,6,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,   0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,     0,0,0,0,0,0,0,0,7,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,   0,0,0,0,0,0,0,0,6,0,0,0,0,0,0,0,     0,0,0,0,0,0,8,9,10,9,8,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,   0,0,0,0,0,0,0,0,7,0,0,0,0,0,0,0,     0,0,0,0,0,0,9,10,10,10,9,0,0,0,0,0,
    0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,   0,0,0,0,0,0,6,7,10,7,6,0,0,0,0,0,    0,0,0,0,6,7,10,10,10,10,10,7,6,0,0,0,
    0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,   0,0,0,0,0,0,0,0,7,0,0,0,0,0,0,0,     0,0,0,0,0,0,9,10,10,10,4,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,   0,0,0,0,0,0,0,0,6,0,0,0,0,0,0,0,     0,0,0,0,0,0,8,9,10,9,8,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,   0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,     0,0,0,0,0,0,0,0,7,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,   0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,     0,0,0,0,0,0,0,0,6,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,   0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,     0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,   0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,     0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,   0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,     0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,   0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,     0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
};


/* Star-Position from 0, 0  */
JADVERTEX TPStars[] = {	/* 26 Stars, Rectangles, Counter Clockwise winding  */
    /* Star 1  */
    { -28.0,  32.0, 20.0 },  { -12.0,  32.0, 20.0 },
    { -12.0,  32.0, 36.0 },  { -28.0,  32.0, 36.0 },
    /* Star 2 */
    { -14.0,  16.0, 14.0 },  {   2.0,  16.0, 14.0 },
    {   2.0,  16.0, 30.0 },  { -14.0,  16.0, 30.0 },
    /* Star 3 */
    {  22.0,  48.0, 16.0 },  {  38.0,  48.0, 16.0 },
    {  38.0,  48.0, 32.0 },  {  22.0,  48.0, 32.0 },
    /* Star 4 */
    { -28.0,  32.0, 39.0 },  { -12.0,  32.0, 39.0 },
    { -12.0,  32.0, 55.0 },  { -28.0,  32.0, 55.0 },
    /* Star 5 */
    {  -2.0,  48.0, 32.0 },  {  14.0,  48.0, 32.0 },
    {  14.0,  48.0, 48.0 },  {  -2.0,  48.0, 48.0 },
    /* Star 6 */
    {  20.0,  16.0, 33.0 },  {  36.0,  16.0, 33.0 },
    {  36.0,  16.0, 49.0 },  {  20.0,  16.0, 49.0 },
    /* Star 7 */
    { -42.0,  32.0, 54.0 },  { -26.0,  32.0, 54.0 },
    { -26.0,  32.0, 70.0 },  { -42.0,  32.0, 70.0 },
    /* Star 8 */
    { -22.0,  48.0, 46.0 },  {  -6.0,  48.0, 46.0 },
    {  -6.0,  48.0, 62.0 },  { -22.0,  48.0, 62.0 },
    /* Star 9 */
    {  -4.0,  16.0, 59.0 },  {  12.0,  16.0, 59.0 },
    {  12.0,  16.0, 75.0 },  {  -4.0,  16.0, 75.0 },
    /* Star 10 */
    {  10.0,  32.0, 48.0 },  {  -6.0,  32.0, 48.0 },
    {  -6.0,  32.0, 64.0 },  {  10.0,  32.0, 64.0 },
    /* Star 11 */
    { -34.0,  48.0, 71.0 },  { -18.0,  48.0, 71.0 },
    { -18.0,  48.0, 87.0 },  { -34.0,  48.0, 87.0 },
    /* Star 12 */
    { -22.0,  16.0, 82.0 },  {  -6.0,  16.0, 82.0 },
    {  -6.0,  16.0, 98.0 },  { -22.0,  16.0, 98.0 },
    /* Star 13 */
    {  18.0,  32.0, 77.0 },  {  34.0,  32.0, 77.0 },
    {  34.0,  32.0, 93.0 },  {  18.0,  32.0, 93.0 },
    /* Star 14 */
    { -34.0, -32.0, 19.0 },  { -18.0, -32.0, 19.0 },
    { -18.0, -32.0, 35.0 },  { -34.0, -32.0, 35.0 },
    /* Star 15 */
    {   2.0, -48.0, 17.0 },  {  18.0, -48.0, 17.0 },
    {  18.0, -48.0, 33.0 },  {   2.0, -48.0, 33.0 },
    /* Star 16 */
    {  15.0, -16.0, 23.0 },  {  31.0, -16.0, 23.0 },
    {  31.0, -16.0, 39.0 },  {  15.0, -16.0, 39.0 },
    /* Star 17 */
    { -36.0, -32.0, 40.0 },  { -20.0, -32.0, 40.0 },
    { -20.0, -32.0, 56.0 },  { -36.0, -32.0, 56.0 },
    /* Star 18 */
    { -14.0, -48.0, 35.0 },  {   2.0, -48.0, 35.0 },
    {   2.0, -48.0, 51.0 },  { -14.0, -48.0, 51.0 },
    /* Star 19 */
    {  15.0, -16.0, 42.0 },  {  31.0, -16.0, 42.0 },
    {  31.0, -16.0, 58.0 },  {  15.0, -16.0, 58.0 },
    /* Star 20 */
    { -26.0, -32.0, 55.0 },  { -10.0, -32.0, 55.0 },
    { -10.0, -32.0, 71.0 },  { -26.0, -32.0, 71.0 },
    /* Star 21 */
    { -13.0, -48.0, 66.0 },  {   3.0, -48.0, 66.0 },
    {   3.0, -48.0, 82.0 },  { -13.0, -48.0, 82.0 },
    /*Star 22 */
    {   6.0, -16.0, 53.0 },  {  22.0, -16.0, 53.0 },
    {  22.0, -16.0, 69.0 },  {   6.0, -16.0, 69.0 },
    /* Star 23 */
    {  26.0, -32.0, 61.0 },  {  42.0, -32.0, 61.0 },
    {  42.0, -32.0, 77.0 },  {  26.0, -32.0, 77.0 },
    /* Star 24 */
    { -34.0, -48.0,  84.0 },  { -18.0, -48.0,  84.0 },
    { -18.0, -48.0, 100.0 },  { -34.0, -48.0, 100.0 },
    /* Star 25 */
    { -34.0, -16.0,  84.0 },   { -50.0, -16.0,  84.0 },
    { -50.0, -16.0, 100.0 },   { -34.0, -16.0, 100.0 },
    /* Star 26 */
    {   5.0, -32.0, 76.0 },    {  21.0, -32.0, 76.0 },
    {  21.0, -32.0, 92.0 },    {   5.0, -32.0, 92.0 }
};


/* Stars round a Rectangle 32 x 32 */
unsigned char AnimateBits[] = {	// Bits...
    0x01, 0x06, 0x1B, 0x6E,	// 00000001b, 00000110b, 00011011b, 01101110b
    0xB9, 0xE4, 0x90, 0x40	// 10111001b, 11100100b, 10010000b, 01000000b
};

GLint RectStarPositions[] = {	// <X,Y>@@starxy LABEL BYTE
    0,6,  20,20,  5,24,  5,15
};

/* Stars in a Tile */
JADVERTEX TileStars[] = {		//  <X,Y,Z> @@starpos LABEL BYTE
    /* Star 1 */
    {  -8.0, -48.0, 112.0 }, {   8.0, -48.0, 112.0 },
    {   8.0, -48.0, 128.0 }, {  -8.0, -48.0, 128.0 },
    /* Star 2 */
    { -40.0, -42.0, 104.0 }, { -24.0, -42.0, 104.0 },
    { -24.0, -42.0, 120.0 }, { -40.0, -42.0, 120.0 },
    /* Star 3 */
    { -56.0, -36.0,  96.0 }, { -40.0, -36.0,  96.0 },
    { -40.0, -36.0, 112.0 }, { -56.0, -36.0, 112.0 },
    /* Star 4 */
    { -32.0, -30.0, 110.0 }, { -16.0, -30.0, 110.0 },
    { -16.0, -30.0, 126.0 }, { -32.0, -30.0, 126.0 },
    /* Star 5 */
    {  40.0, -24.0,  72.0 }, {  56.0, -24.0,  72.0 },
    {  56.0, -24.0,  88.0 }, {  40.0, -24.0,  88.0 },
    /* Star 6 */
    {   0.0, -18.0,  40.0 }, {  16.0, -18.0,  40.0 },
    {  16.0, -18.0,  56.0 }, {   0.0, -18.0,  56.0 },
    /* Star 7 */
    {   8.0, -12.0,  64.0 }, {  24.0, -12.0,  64.0 },
    {  24.0, -12.0,  80.0 }, {   8.0, -12.0,  80.0 },
    /* Star 8 */
    {  24.0, -6.0,  72.0 }, {  40.0, -6.0,  72.0 },
    {  40.0, -6.0,  88.0 }, {  24.0, -6.0,  88.0 },
    /* Star 9 */
    { -39.0, 6.0,  43.0 }, { -23.0, 6.0,  43.0 },
    { -23.0, 6.0,  59.0 }, { -39.0, 6.0,  59.0 },
    /* Star 10 */
    { -16.0, 12.0,  23.0 }, {   0.0, 12.0,  23.0 },
    {   0.0, 12.0,  39.0 }, { -16.0, 12.0,  39.0 },
    /* Star 11 */
    { -66.0, 18.0,  72.0 }, { -50.0, 18.0,  72.0 },
    { -50.0, 18.0,  88.0 }, { -66.0, 18.0,  88.0 },
    /* Star 12 */
    { -35.0, 24.0,  27.0 }, { -19.0, 24.0,  27.0 },
    { -19.0, 24.0,  43.0 }, { -35.0, 24.0,  43.0 },
    /* Star 13 */
    { -21.0, 30.0,  46.0 }, {  -5.0, 30.0,  46.0 },
    {  -5.0, 30.0,  62.0 }, { -21.0, 30.0,  62.0 },
    /* Star 14 */
    { -52.0, 36.0,  40.0 }, { -36.0, 36.0,  40.0 },
    { -36.0, 36.0,  56.0 }, { -52.0, 36.0,  56.0 },
    /* Star 15 */
    { -32.0, 42.0,  28.0 }, { -16.0, 42.0,  28.0 },
    { -16.0, 42.0,  44.0 }, { -32.0, 42.0,  44.0 },
    /* Star 16 */
    { -66.0, 48.0,  68.0 }, { -50.0, 48.0,  68.0 },
    { -50.0, 48.0,  84.0 }, { -66.0, 48.0,  84.0 },
};

unsigned int TileStarBits[] = {	//
    0x00000001, 0x00000156, 0x000056AB, 0x0055ABFE, 0x15AAFEA9,
    0x6AFFA954, 0xBFAA5400, 0xEA550000, 0x95000000, 0x40000000
};

/* --------- The doors -------- */
/* ----- First Jambs --- */
JADDISPVERTEX Jamb[] = {	/* Type 1 */
    {-16.0, -64.0,  0 },
    {-16.0, -48.0,  0 },
    {-16.0, -48.0, 96 },
    {-16.0, -64.0, 96 },
    { -4.0, -48.0,  0 },
    {-16.0, -48.0,  0 },
    {-16.0, -48.0, 96 },
    { -4.0, -48.0, 96 },
    { -4.0, -56.0,  0 },
    { -4.0, -48.0,  0 },
    { -4.0, -48.0, 96 },
    { -4.0, -56.0, 96 },
    {  4.0, -56.0,  0 },
    { -4.0, -56.0,  0 },
    { -4.0, -56.0, 96 },
    {  4.0, -56.0, 96 },
    {  4.0, -56.0, 96 },
    {  4.0, -48.0, 96 },
    {  4.0, -48.0,  0 },
    {  4.0, -56.0,  0 },
    { 16.0, -48.0,  0 },
    {  4.0, -48.0,  0 },
    {  4.0, -48.0, 96 },
    { 16.0, -48.0, 96 },
    { 16.0, -64.0,  0 },
    { 16.0, -48.0,  0 },
    { 16.0, -48.0, 96 },
    { 16.0, -64.0, 96 },

    /* --- Right Jamb --- */
    { 16.0, 48.0,  0 },
    { 16.0, 64.0,  0 },
    { 16.0, 64.0, 96 },
    { 16.0, 48.0, 96 },
    {  4.0, 48.0,  0 },
    { 16.0, 48.0,  0 },
    { 16.0, 48.0, 96 },
    {  4.0, 48.0, 96 },

    {  4.0, 56.0,  0 },
    {  4.0, 48.0,  0 },
    {  4.0, 48.0, 96 },
    {  4.0, 56.0, 96 },

    { -4.0, 56.0,  0 },
    {  4.0, 56.0,  0 },
    {  4.0, 56.0, 96 },
    { -4.0, 56.0, 96 },

    { -4.0, 48.0,  0 },
    { -4.0, 56.0,  0 },
    { -4.0, 56.0, 96 },
    { -4.0, 48.0, 96 },

    {-16.0, 48.0,  0 },
    { -4.0, 48.0,  0 },
    { -4.0, 48.0, 96 },
    {-16.0, 48.0, 96 },
    {-16.0, 64.0,  0 },
    {-16.0, 48.0,  0 },
    {-16.0, 48.0, 96 },
    {-16.0, 64.0, 96 },

    /* ------- Upper End of Jambs */
    { 16.0, -64.0, 96 },
    { 16.0, -48.0, 96 },
    {-16.0, -48.0, 96 },
    {-16.0, -64.0, 96 },

    { 16.0,  48.0, 96 },
    { 16.0,  64.0, 96 },
    {-16.0,  64.0, 96 },
    {-16.0,  48.0, 96 }
};

/* ----- VSliding Door ---- */
JADDISPVERTEX VSlide[] = {
    /* Back */
    {-4.0,  48.0,  0 },
    {-4.0, -48.0,  0 },
    {-4.0, -48.0, 96 },
    {-4.0,  48.0, 96 },
    /* Front */
    { 4.0, -48.0,  0 },
    { 4.0,  48.0,  0 },
    { 4.0,  48.0, 96 },
    { 4.0, -48.0, 96 },
    /* Top */
    { 4.0, -48.0, 96 },
    { 4.0,  48.0, 96 },
    {-4.0,  48.0, 96 },
    {-4.0, -48.0, 96 }
};

/* ---- Horizontally sliding door */
JADDISPVERTEX HSlide[] = {
    {-4.0, 48.0,  0 },
    {-4.0,  0.0,  0 },
    {-4.0,  0.0, 96 },
    {-4.0, 48.0, 96 },
    {-4.0,  0.0,  0 },
    { 4.0,  0.0,  0 },
    { 4.0,  0.0, 96 },
    {-4.0,  0.0, 96 },
    {-4.0,  0.0,  0 },
    {-4.0, 48.0,  0 },
    {-4.0, 48.0, 96 },
    {-4.0,  0.0, 96 },
    /* left side */
    {-4.0,   0.0,  0 },
    {-4.0, -48.0,  0 },
    {-4.0, -48.0, 96 },
    {-4.0,   0.0, 96 },
    { 4.0,   0.0,  0 },
    {-4.0,   0.0,  0 },
    {-4.0,   0.0, 96 },
    { 4.0,   0.0, 96 },
    { 4.0, -48.0,  0 },
    { 4.0,   0.0,  0 },
    { 4.0,   0.0, 96 },
    { 4.0, -48.0, 96 },
    /* right top */
    {-4.0,  48.0, 96 },
    {-4.0,   0.0, 96 },
    { 4.0,   0.0, 96 },
    { 4.0,  48.0, 96 },
    /* left top */
    { 4.0,  -48.0, 96 },
    { 4.0,    0.0, 96 },
    {-4.0,    0.0, 96 },
    {-4.0,  -48.0, 96 }
};

int HSlidePRight[11] = { /* Which points to "slide" right */
    1, 2, 4, 5, 6, 7, 8, 11, 25, 26, 0
};

int HSlidePLeft[11] = {	/* Which points to "slide" left */
     12, 15, 16, 17, 18, 19, 21, 22, 29, 30, 0
};

/* The "Clocks" */
int AnimatedMainClock = 10;
int AnimatedClocks[ANIM_MAXCLOCKS + 1];

/******************************************************************************
* CODE									      *
******************************************************************************/

/*
 * Name:
 *     Animated_Init
 * Description:
 *     Initialisation for Animated-Effects. Generates alll the needed Datas
 *     and Textures.
 * Output:
 *    0, if anything has gone wrong.
 */
int Animated_Init(void)
{
    return 1;
}

/*
 * Name:
 *     Animated_Shutdown
 * Description:
 *     Shutdown for Animated-Effects. Destroys all needed datas
 *     and textures.
 * Output:
 *    0, if anything has gone wrong.
 */
int Animated_Shutdown(void)
{
    return 1;
}

/*
 * Name:
 *     Animated_Clock
 * Description:
 *     Drives the "Clock" for Animated-Effects. Possibility to have
 *     different animation speed for each.
 */
void Animated_Clock(int tickspassed)
{
    int i;

    for (i = 0; i <= ANIM_MAXCLOCKS; i++) {
       if (AnimatedClocks[i] > 0) {
           AnimatedClocks[i] -= tickspassed;
       }
       else {
           AnimatedClocks[i] = 167;	/* 6 times / second */
       }
    }
}


/*
 *  Name:
 *      Animated_Teleport
 *  Description:
 *      Displays a "Starfield" formed of 26 Stars at Point 0.0.
 *  Input:
 *	angle:	    Look-Angle of the Camera
 */

void Animated_Teleport(int angle)
{
    // static int starbitmask = 0x3047DF32;
    static int starbits = 0;
    int i;
    JADVERTEX *starrect;

    glMatrixMode(GL_MODELVIEW);         /* Select Modelview-Matrix	*/
    glPushMatrix();			/* Save it			*/
    /* */
    glRotatef((GLfloat)angle + 90.0, 0.0, 0.0, 1.0); /* Look at Camera */

     /* Slowdown for Tests */
     if (AnimatedClocks[0] <= 0) {
         starbits ^= 1;
     }


    if (starbits) {
        glColor3ub(196, 44, 168);
    }
    else {
        glColor3ub(235, 53, 202);
    }

    glBegin(GL_QUADS);
        starrect = &TPStars[0];
        for (i = 0; i < 26; i++) {
            glVertex3fv(&starrect[0].x);
            glVertex3fv(&starrect[1].x);
            glVertex3fv(&starrect[2].x);
            glVertex3fv(&starrect[3].x);

            starrect += 4;	/* Next rect */
        }
    glEnd();
    /* */
    glPopMatrix();			/* Get it back			*/
}

/*
 *  Name:
 *      Animated_SpellStars
 *  Description:
 *      Displays a "Starfield" formed of diverse Stars at Point 0.0.
 *  Input:
 *	angle:	    Look-Angle of the Camera
 */

 void Animated_SpellStars(int angle)
 {
     static GLfloat Colors[4][3] = {
         { 0.0, 0.0, 0.0 }, { 1.0, 1.0, 1.0 }, { 0.7, 0.7, 0.7 }, { 0.3, 0.3, 0.3 }
     };
     static int starbitidx = -1;	/* guaranteed that first time start by zero */
     unsigned int starbits;
     int i;
     JADVERTEX *starrect;

     /* Slowdown for Tests */
     if (AnimatedClocks[0] == 0) {
         starbitidx++;
	 if (starbitidx > 9)
             starbitidx = 0;
     }


     glMatrixMode(GL_MODELVIEW);        /* Select Modelview-Matrix	*/
     glPushMatrix();			/* Save it			*/
     /* */
     glRotatef((GLfloat)angle + 90.0, 0.0, 0.0, 1.0); /* Look at Camera */

     starrect = &TileStars[0];			/* Point on the Rectangles */
     starbits = TileStarBits[starbitidx];	/* Get the bitmaks	    */

     glBegin(GL_QUADS);
        for (i = 0; i < 16; i++) {
            // Color depends on staridx */
            if ((starbits & 3) > 0) {
                glColor3fv(Colors[starbits & 3]);
            	glVertex3fv(&starrect[0].x);
            	glVertex3fv(&starrect[1].x);
            	glVertex3fv(&starrect[2].x);
            	glVertex3fv(&starrect[3].x);
            }
            starrect += 4;			/* Next rectangles */
            starbits >>= 2;			/* Next star       */
        }
    glEnd();

    /* */
    glPopMatrix();			/* Get it back			*/
 }

/*
 *  Name:
 *      Animated_Doors
 *  Description:
 *	Displays kind of a "Door".
 *  Input:
 *	Type:     Which type door (1 or 2)
 *	Position: Opening position (0..15)
 *		  0 means open, 15 means closed.
 *	angle:    Which direction angle the door to turn
 *
 */

void Animated_Doors(int type, int position, int maxsteps, float height, float angle)
{
    static GLubyte colors[] = { 196, 196, 196,
    				 51,  51,  51,		/* Some grey 	    */
                                  0,  48, 196, 		/* Turquoise - like */
                                255, 255, 255 };

    GLfloat floatpos, doorpos1, doorpos2;
    int *pslidepleft, *pslidepright;
    int i;


    /* Angle is counterclockwise */
    glPushMatrix();			/* Save Matrix		*/
    glRotatef(angle, 0.0, 0.0, 1.0);	/* Rotate around z-Axis */


    /* Get the opening of the door in percent */
    floatpos = (GLfloat)position / (GLfloat)maxsteps;

    glBegin(GL_QUADS);
        /* Display the jambs */
        glColor3ubv(&colors[0]);	/* light gray */
	for (i = 0; i < 28; i++) {
	    glVertex3fv(&Jamb[i].x);
        }

        glColor3ubv(&colors[9]);	/* red      */
	for (; i < 56; i++) {
	    glVertex3fv(&Jamb[i].x);
        }

        glColor3ubv(&colors[3]);	 /* Top: Dark gray */
        for (; i < 64; i ++) {
            glVertex3fv(&Jamb[i].x);
        }

        glColor3ubv(&colors[6]);	 /* Light turquoise */

        switch (type) {
    	    case 1: /* Bottom is 0, top is "height" */
            	if (position > 0) {	/* Position 0 is invisible */
        	    doorpos1 = height - (height * floatpos);
                    /* Set the opening position of the door */
                    VSlide[0].z = doorpos1;
        	    VSlide[1].z = doorpos1;
        	    VSlide[4].z = doorpos1;
        	    VSlide[5].z = doorpos1;

                    /* And now display the doors */
                    for (i = 0; i < 8; i++) {
                        glVertex3fv(&VSlide[i].x);
                    }

                    /* And the door top */
                    glColor3ubv(&colors[3]); 	/* Top: Dark gray */
                    for (; i < 12; i++) {
                        glVertex3fv(&VSlide[i].x);
                    }

                } /* if position > 0 */
                break;

            case 2: /* doorpos1 is left position */
        	doorpos1 = -(DISP_TILESIZE / 2) + ((DISP_TILESIZE / 2) * floatpos);
                doorpos2 =  (DISP_TILESIZE / 2) - ((DISP_TILESIZE / 2) * floatpos);

                pslidepleft  = HSlidePLeft;
                pslidepright = HSlidePRight;

                /* Set the opening position of the door */
                for (i = 0; i < 10; i++) {
                    HSlide[*pslidepleft].x  = doorpos1;
                    HSlide[*pslidepright].x = doorpos2;
                }

                /* And now display the door */
                for (i = 0; i < 24; i++) {  /* Left and right */
		    glVertex3fv(&HSlide[i].x);
                }

                glColor3ubv(&colors[3]);	/* Top: Dark gray */
                for (; i < 32; i++) {
                    glVertex3fv(&HSlide[i].x);
                }

                break;
        } /* switch */

    glEnd();

    glPopMatrix();
}


